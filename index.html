<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image to Drawing Converter</title>

<style>
body{
  font-family: Arial;
  background:#ececec;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.box{
  background:white;
  padding:20px;
  width:850px;
  max-width:95%;
  border-radius:10px;
  box-shadow:0 0 15px rgba(0,0,0,0.2);
  text-align:center;
}

.canvases{
  display:flex;
  gap:15px;
  margin-top:15px;
}

canvas{
  border:1px solid #999;
  width:100%;
  max-width:400px;
}

button{
  margin-top:15px;
  padding:8px 15px;
  font-size:15px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="box">
  <h2>üé® Image to Drawing Converter</h2>
  <p>Upload an image to generate a smooth pencil sketch</p>

  <input type="file" id="upload" accept="image/*">

  <div class="canvases">
    <div>
      <p>Original</p>
      <canvas id="original"></canvas>
    </div>
    <div>
      <p>Sketch</p>
      <canvas id="sketch"></canvas>
    </div>
  </div>

  <button id="downloadBtn" disabled>‚¨áÔ∏è Download Sketch</button>
</div>

<script>
const upload = document.getElementById("upload");
const originalCanvas = document.getElementById("original");
const sketchCanvas = document.getElementById("sketch");
const downloadBtn = document.getElementById("downloadBtn");

const octx = originalCanvas.getContext("2d");
const sctx = sketchCanvas.getContext("2d");

/*
  MAIN EVENT: when image is selected
*/
upload.addEventListener("change", function(){
  const file = this.files[0];
  if(!file) return;

  const img = new Image();

  img.onload = function(){

    originalCanvas.width = sketchCanvas.width = img.width;
    originalCanvas.height = sketchCanvas.height = img.height;

    octx.drawImage(img,0,0);
    sctx.drawImage(img,0,0);

    let imageData = sctx.getImageData(0,0,img.width,img.height);
    let data = imageData.data;

    /*
      STEP 1: GRAYSCALE
    */
    for(let i=0;i<data.length;i+=4){
      let gray = (data[i] + data[i+1] + data[i+2]) / 3;
      data[i] = data[i+1] = data[i+2] = gray;
    }

    /*
      STEP 2: STRONG SMOOTHING (multiple blur passes)
    */
    for(let pass=0; pass<3; pass++){
      for(let i=0;i<data.length-4;i+=4){
        data[i]   = (data[i] + data[i+4]) / 2;
        data[i+1] = (data[i+1] + data[i+5]) / 2;
        data[i+2] = (data[i+2] + data[i+6]) / 2;
      }
    }

    /*
      STEP 3: EDGE DETECTION (soft pencil lines)
    */
    for(let i=0;i<data.length;i+=4){
      let diff = Math.abs(data[i] - (data[i+4] || data[i]));
      let value = diff > 12 ? 0 : 255;   // low threshold = smoother sketch
      data[i] = data[i+1] = data[i+2] = value;
    }

    sctx.putImageData(imageData,0,0);
    downloadBtn.disabled = false;
  };

  img.src = URL.createObjectURL(file);
});

/*
  DOWNLOAD SKETCH
*/
downloadBtn.addEventListener("click", function(){
  const link = document.createElement("a");
  link.download = "sketch.png";
  link.href = sketchCanvas.toDataURL();
  link.click();
});
</script>

</body>
</html>

